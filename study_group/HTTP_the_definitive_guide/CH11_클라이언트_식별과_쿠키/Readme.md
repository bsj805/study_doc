# 클라이언트 식별과 쿠키

# 11.1 개별 접촉

개인화위해서 개인 식별 or 방문자의 연속적인 요청 추적위해 사용자식별필요.

ex. 검색 어떤거 다음에 어떤거 했는지 로그


# 11.2 HTTP 헤더

- FROM : 사용자의 이메일주소
  - 스팸메일 보낼때 악용됨
  - robot들이 사용
- User-Agent: 어떤 브라우저
  - 사용자 식별엔 도움안됨
- Referer: 현재 페이지로 유입하게 한 웹페이지 URL

# 11.3 클라이언트 IP 주소
- 사용자 IP가 unique할테니까?
  - http 헤더에는 없고, HTTP 요청 보내는 반대편 TCP의 IP주소 알 수 있다. 
    - but, 여러 이용자가 같은 컴퓨터 사용시 식별 불가.
    - ISP가 동적으로 IP 할당하는 경우가 많음.
    - NAT 때문에 하나의 IP주소로 변환된다.
    - 프락시의 IP 주소를 보게 된다면?

# 11.4 사용자 로그인

웹사이트에 로그인시키면 식별 가능하지.

HTTP 401 Login Required 보내주고, 브라우저는 로그인 후부터는 Authorization 헤더에 그 정보를 담아 보낸다.

이 다음의 모든 요청에 대해서 브라우저가 모두 아이디 비밀번호를 보내준다.

# 11.5 뚱뚱한 URL

사용자의 URL마다 상태정보를 포함하게 한다면?

해당 사용자는 하나의 unqiue한 id를 가지고 사이트를 돌아다니게 되어, 식별 가능

- 공유 못한다.
- 서버 부하 가중 (URL 별 html 페이지 제작)
- 캐시 불가
- 사용자 이탈했다 돌아오면 새 사용자

# 11.6 쿠키
- 쿠키는 캐시와 충돌할 수 있어서, 캐시나 브라우저는 쿠키에 있는 내용물 캐싱 안해.

## 11.6.1 쿠키 타입

session cookie vs persistent cookie

- session cookie: 브라우저 닫으면 삭제됨
  - Discard 파라미터, Expires, Max-age 파라미터
- persistent cookie: 디스크에 저장되어, 브라우저 닫아도, 컴퓨터 재시작해도 남아있다.
  - 설정 정보 또는 로그인 정보 유지


## 11.6.2 쿠키 동작방법
- 사용자가 웹사이트 방문시 서버가 저장해둔 쿠키정보 읽어올 수 있게 됨.
- 사용자에게 유일한 값을 쿠키에 할당
- 쿠키는 key:value 형태 리스트를 가지고, Set-Cookie 같은 HTTP 응답 헤더에 기술되어 사용자에게 전달된다.

## 11.6.3 쿠키 상자
브라우저가 쿠키 저장할 책임 있다. == HTTP State Management Mechanism

구글은 SQLite 파일에 쿠키를 저장한다.

IE는 디렉토리에 개별 파일로 쿠키를 저장

## 11.6.4 사이트마다 다른 쿠키들.
- 브라우저가 모든 쿠키를 모든 사이트에 전달하진 않는다.
  - 특정 서버 특화 이름/값 쌍을 가지기 때문.
  - 즉, 쿠키 생성한 서버에만 정보 전달
  - 같은 광고사에서 제공하는 광고 붙은 사이트 여러곳에 접속하면 그 쿠키정보 그대로 전달해준다. (해당 광고사 서버는 그대로니까)

### 쿠키 Domain 속성
- 어떤 사이트에 접속할때 쿠키 같이 보내줘야 하는지 기술 가능
  - `Set-cookie: user='mary'; domain='naver.com'`
- Path도 기술가능.


## 11.6.5 쿠키 구성요소
- Version 0
  - 이름=값
  - Expires (언제 쿠키 죽나)
  - Domain
  - Path
  - Secure (HTTPS통신일때만)

모든 쿠키는 Cookie 헤더에 한데 이어 붙인다.

- Version 1
  - 어떤 쿠키가 어떤 이유로 사용되는지 comment제공 
  - 파기 주기랑 상관없이 강제 삭제 가능
  - Max-Age 상대값으로 생명 결정
  - URL 포트 번호로도 쿠키 제어
  - domain, port, path filter 있으면 Cookie 헤더에 담아 되돌려보냄.
    - 클라이언트가 갖고있던 path filter 정보도 서버에 같이 전달한다는 뜻임. (물론 보내지는 쿠키에 대해서만)


## 11.6.9  캐시와 쿠키

- 캐시안되야 할 문서라면 해당 문서에는 Cache-Control no-cache="Set-Cookie"
- Set-Cookie 헤더 갖고있으면 헤더는 캐시할 때 주의해야. 
  - 모든 요청마다 원 서버와 재검사 시켜서 클라이언트의 응답에 특정 Set-Cookie 헤더 값을 보내주면 괜찮다.
    - Cache-Control: must-revalidate, max-age=0
- Cookie 헤더 가진 요청을 주의
  - 결과 컨텐츠가 개인정보를 담고 있을 수도 있다. 
  - 



